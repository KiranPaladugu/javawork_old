package com.marconi.tmp.tools;

import java.io.File;
import java.io.IOException;

import com.marconi.fusion.base.application.Profile;

public class BERDataConverter {
	private String confPath;
	private String berHome;
	private final String profileName = "I36Plugin.properties";
	private Profile profile;
	private int added = 0;
	private BERConvManager berManager;

	// private final boolean ready = false;

	public BERDataConverter(final String confPath, final String berHome) {
		if (confPath == null || berHome == null) {
			System.out.println("Invalid Args..");
		}
		this.confPath = confPath;
		this.berHome = berHome;
		if (!loadProfile()) {
			System.out.println("Profile is not loaded... check path in arguments");
			return;
		}
	}

	public void start(boolean override,boolean remove) {

		if (profile == null) {
			System.out.println("Profile is not loaded... check path in arguments");
			return;
		}

		final File berFileLoc = new File(berHome);
		if (berFileLoc.exists() && berFileLoc.isDirectory()) {
			final File berFiles[] = berFileLoc.listFiles();
			berManager = new BERConvManager(profile, berHome, berFiles.length,override,remove);
			System.out.println(">> Total Number of Files.." + berFiles.length);
			for (final File berFile : berFiles) {
				if (berFile.isFile()) {
					berManager.enQueue(berFile);
					added++;
				}
			}
		}
		System.out.println(">> Total Files added for conversion :" + added);
	}

	public String getLatestVersion() {
		if (profile != null) {
			return profile.getProperty("Plugin.ASN.X36Version");
		} else {
			return "";
		}
	}

	private boolean loadProfile() {
		boolean flag = false;
		try {
			profile = new Profile(confPath + File.separator + profileName);
			flag = true;
		} catch (final IOException e) {
			e.printStackTrace();
		}
		return flag;
	}

	static public void main(final String[] args) {

		// args[0] = conf directory path
		// args[1] = BER directory path.
		// args[2] = write override
		// args[4] = delete oldfiles

		if (args == null || args.length >= 2) {
			System.out.println("Invalid args.. \n ");
			return;
		}
		final String confPath = args[0];
		final String berPath = args[1];
		boolean override = false;
		boolean remove = false;
		if (args.length > 2) {
			try {
				override = Boolean.parseBoolean(args[2]);
				remove = Boolean.parseBoolean(args[3]);
			} catch (final Exception e) {
			}
		}

		final BERDataConverter converter = new BERDataConverter(confPath, berPath);
		converter.start(override, remove);

	}
}
